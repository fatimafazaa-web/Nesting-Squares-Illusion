<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تجربة المربعات المتداخلة مع صورة / Canva</title>
  <style>
    body { font-family: system-ui, Arial; padding: 20px; direction: rtl; }
    ul { list-style: none; margin: 6px 0 6px 18px; padding-left: 8px; }
    li { margin: 6px 0; }
    label { cursor: pointer; user-select: none; display: inline-flex; gap: 8px; align-items: center; }
    .controls { margin-top: 12px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .box { background:#f7f7f7; padding:12px; border-radius:6px; display:inline-block; vertical-align:top; }
    .image-panel { display:inline-block; margin-left:18px; vertical-align:top; max-width:320px; }
    .image-panel img, .image-panel iframe { display:block; max-width:100%; height:auto; border-radius:6px; border:1px solid #ddd; }
    .image-actions { margin-top:8px; display:flex; gap:6px; }
    .muted { color:#666; font-size:0.95rem; margin-bottom:8px; }
    button, input[type="file"] { cursor:pointer; padding:8px 10px; border-radius:6px; border:0; background:#e0e0e0; }
    button:hover { background:#d0d0d0; }
    @media (max-width:720px) {
      .image-panel { display:block; margin:12px 0 0 0; max-width:100%; }
      .box { display:block; width:100%; margin-bottom:12px; }
    }
  </style>
</head>
<body>
  <h2>تجربة المربعات المتداخلة — مع صورة / تصميم Canva</h2>
  <p class="muted">حمّلي صورة للاختبار أو استخدمي الصورة العيّنة أو اعرضي تصميم Canva المضمّن. يمكنك تعديل رابط Canva أدناه أو لصق كود الـ iframe إذا كان متوفراً.</p>

  <div class="controls">
    <label>
      <input id="fileInput" type="file" accept="image/*" style="display:none">
      <button id="chooseBtn" type="button">اختيار صورة</button>
    </label>
    <button id="sampleBtn" type="button">استخدام صورة عيّنة</button>
    <button id="canvaBtn" type="button">عرض تصميم Canva</button>
    <button id="clearBtn" type="button">إزالة الصورة/التصميم</button>
  </div>

  <div style="margin-top:12px;">
    <div class="box" id="checkboxBox">
      <ul>
        <li>
          <label><input type="checkbox"> العناصر الرئيسية</label>
          <ul>
            <li>
              <label><input type="checkbox"> مجموعة A</label>
              <ul>
                <li><label><input type="checkbox"> A1</label></li>
                <li><label><input type="checkbox"> A2</label></li>
                <li><label><input type="checkbox"> A3</label></li>
              </ul>
            </li>

            <li>
              <label><input type="checkbox"> مجموعة B</label>
              <ul>
                <li><label><input type="checkbox"> B1</label></li>
                <li><label><input type="checkbox"> B2</label></li>
              </ul>
            </li>

            <li>
              <label><input type="checkbox"> عنصر منفرد</label>
            </li>
          </ul>
        </li>
      </ul>

      <div class="controls" style="margin-top:10px;">
        <button id="reset">إعادة تعيين</button>
        <button id="check-all">تحديد الكل</button>
      </div>
    </div>

    <div class="image-panel" id="imagePanel" aria-hidden="false" style="display:inline-block;">
      <div class="muted">معاينة الصورة / التصميم:</div>

      <!-- حاوية عرض ديناميكية: هنا وضعنا iframe لتصميم Canva بشكل افتراضي.
           لتغيير الرابط عدّلي قيمة canvaEmbedUrl في السكربت أدناه أو الصقي كود iframe كامل داخل هذا الـ div -->
      <div id="previewContainer">
        <!-- iframe الافتراضي لتصميم Canva -->
        <iframe
          id="canvaFrameDefault"
          src="https://www.canva.com/design/DAG9gRCHk3I/hYz-HrP8CQLe4_FQA6mRkw/view?embed"
          width="100%"
          height="360"
          frameborder="0"
          allowfullscreen
          loading="lazy"
          title="تصميم من Canva">
        </iframe>
      </div>

      <div class="image-actions">
        <small id="imageName" style="align-self:center;color:#444;">تصميم من Canva</small>
      </div>
    </div>
  </div>

  <script>
    // ===== المربعات المتداخلة =====
    document.querySelectorAll('#checkboxBox input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', (e) => {
        const checkbox = e.target;
        setChildrenChecked(checkbox, checkbox.checked);
        updateParents(checkbox);
      });
    });

    function setChildrenChecked(checkbox, checked) {
      const li = checkbox.closest('li');
      if (!li) return;
      const childCheckboxes = li.querySelectorAll('ul input[type="checkbox"]');
      childCheckboxes.forEach(c => {
        c.checked = checked;
        c.indeterminate = false;
      });
    }

    function updateParents(startCheckbox) {
      let currentLi = startCheckbox.closest('li');
      while (true) {
        const parentUl = currentLi ? currentLi.parentElement : null;
        if (!parentUl) break;
        const parentLi = parentUl.closest('li');
        if (!parentLi) break;

        const parentCheckbox = parentLi.querySelector(':scope > label input[type="checkbox"]')
                              || parentLi.querySelector('input[type="checkbox"]');

        if (!parentCheckbox) { currentLi = parentLi; continue; }

        const childCheckboxes = parentLi.querySelectorAll(':scope > ul input[type="checkbox"]');

        let checkedCount = 0;
        childCheckboxes.forEach(c => { if (c.checked) checkedCount++; });

        if (checkedCount === 0) {
          parentCheckbox.checked = false;
          parentCheckbox.indeterminate = false;
        } else if (checkedCount === childCheckboxes.length) {
          parentCheckbox.checked = true;
          parentCheckbox.indeterminate = false;
        } else {
          parentCheckbox.checked = false;
          parentCheckbox.indeterminate = true;
        }

        currentLi = parentLi;
      }
    }

    document.getElementById('reset').addEventListener('click', () => {
      document.querySelectorAll('#checkboxBox input[type="checkbox"]').forEach(c => { c.checked = false; c.indeterminate = false; });
    });
    document.getElementById('check-all').addEventListener('click', () => {
      document.querySelectorAll('#checkboxBox input[type="checkbox"]').forEach(c => { c.checked = true; c.indeterminate = false; });
    });

    // ===== عرض الصورة / تبديل iframe =====
    const fileInput = document.getElementById('fileInput');
    const chooseBtn = document.getElementById('chooseBtn');
    const sampleBtn = document.getElementById('sampleBtn');
    const canvaBtn = document.getElementById('canvaBtn');
    const clearBtn = document.getElementById('clearBtn');
    const imagePanel = document.getElementById('imagePanel');
    const previewContainer = document.getElementById('previewContainer');
    const imageName = document.getElementById('imageName');

    // إذا رغبتِ بتغيير رابط Canva، عدّلي المتغير rawCanvaUrl هنا:
    const rawCanvaUrl = 'https://www.canva.com/design/DAG9gRCHk3I/hYz-HrP8CQLe4_FQA6mRkw/view';
    const canvaEmbedUrl = rawCanvaUrl.includes('?') ? rawCanvaUrl + '&embed' : rawCanvaUrl + '?embed';

    // زر اختيار ملف من الجهاز
    chooseBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return clearPreview();
      if (!file.type.startsWith('image/')) { alert('الملف ليس صورة.'); return; }
      const reader = new FileReader();
      reader.onload = (ev) => {
        // استبدال أي محتوى داخل الحاوية بصورة مرفوعة
        previewContainer.innerHTML = '<img id="preview" alt="معاينة الصورة" src="" style="border-radius:6px;">';
        const imgEl = previewContainer.querySelector('#preview');
        imgEl.src = ev.target.result;
        imageName.textContent = file.name;
        showImagePanel();
      };
      reader.readAsDataURL(file);
    });

    // زر استخدام صورة عيّنة
    sampleBtn.addEventListener('click', () => {
      previewContainer.innerHTML = '<img id="preview" alt="معاينة الصورة" src="https://images.unsplash.com/photo-1542281286-9e0a16bb7366?w=800&q=60&auto=format&fit=crop" style="border-radius:6px;">';
      imageName.textContent = 'صورة عيّنة';
      showImagePanel();
    });

    // زر عرض تصميم Canva (ينشئ iframe برمجياً)
    canvaBtn.addEventListener('click', () => {
      previewContainer.innerHTML = '';
      const iframe = document.createElement('iframe');
      iframe.src = canvaEmbedUrl;
      iframe.width = '100%';
      iframe.height = '360';
      iframe.frameBorder = '0';
      iframe.setAttribute('allowfullscreen', '');
      iframe.loading = 'lazy';
      iframe.title = 'تصميم من Canva';
      previewContainer.appendChild(iframe);
      imageName.textContent = 'تصميم من Canva';
      showImagePanel();
    });

    // زر الإزالة: يعيد الحاوية إلى عنصر img فارغ ويخفي اللوحة
    clearBtn.addEventListener('click', clearPreview);

    function showImagePanel() {
      imagePanel.style.display = 'inline-block';
      imagePanel.setAttribute('aria-hidden','false');
    }
    function clearPreview() {
      previewContainer.innerHTML = '<img id="preview" alt="معاينة الصورة" src="">';
      imageName.textContent = '';
      fileInput.value = '';
      imagePanel.style.display = 'none';
      imagePanel.setAttribute('aria-hidden','true');
    }

    // ملاحظة أمان: إذا بقي iframe فارغاً بعد الضغط على "عرض تصميم Canva" فذلك غالباً لأن Canva يمنع تضمين الصفحة في iframe (X-Frame-Options).
    // الحل: نزّلي التصميم من Canva كصورة (Download → PNG/JPG) ثم استخدمي زر "اختيار صورة" لرفعه هنا.
  </script>
</body>
</html>
