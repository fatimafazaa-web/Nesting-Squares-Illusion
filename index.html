<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Nesting Squares Illusion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- استيراد CSS الخاص بـ jsPsych -->
  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" />

  <style>
    body {
      background-color: black;
      margin: 0;
      padding: 0;
      direction: rtl;
      font-family: Arial, sans-serif;
    }
    p {
      color: white;
      font-size: 24px;
      text-align: center;
      margin-top: 20px;
    }
    canvas {
      display: block;
      margin: 20px auto;
      background-color: grey;
      border: 1px solid white;
    }
  </style>
</head>
<body>

  <!-- div لعرض jsPsych -->
  <div id="jspsych-target"></div>

  <!-- استيراد jsPsych والبلجن -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <script src="https://unpkg.com/jspsych@7.3.3/plugins/plugin-html-keyboard-response.js"></script>

  <script>
    // تهيئة jsPsych
    const jsPsych = initJsPsych({
      display_element: 'jspsych-target',
      on_finish: function () {
        jsPsych.data.displayData();
      }
    });

    // إعداد المتغيرات
    const lineWidths = [1, 3, 6]; // سماكات الخط
    const trialsPerCondition = 5;

    // إنشاء المحاولات
    let trials = [];
    for (let i = 0; i < trialsPerCondition; i++) {
      lineWidths.forEach(lw => {
        trials.push({ lineWidth: lw });
      });
    }
    // خلط المحاولات
    trials = jsPsych.randomization.shuffle(trials);

    // دالة رسم المربعات
    function drawSquares(ctx, lineWidth) {
      const centerX = ctx.canvas.width / 2;
      const centerY = ctx.canvas.height / 2;

      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      ctx.lineWidth = lineWidth;
      ctx.strokeStyle = 'white';

      // مربع خارجي
      ctx.strokeRect(centerX - 100, centerY - 100, 200, 200);
      // مربع داخلي
      ctx.strokeRect(centerX - 60, centerY - 60, 120, 120);
    }

    // بناء الـ Timeline
    const timeline = [];

    trials.forEach(trial => {
      // عرض المربعات
      timeline.push({
        type: 'html-keyboard-response',
        stimulus: `<canvas id="illusionCanvas" width="600" height="400"></canvas>`,
        choices: jsPsych.NO_KEYS,
        trial_duration: 1000,
        on_load: () => {
          const canvas = document.getElementById('illusionCanvas');
          const ctx = canvas.getContext('2d');
          drawSquares(ctx, trial.lineWidth);
        }
      });

      // السؤال وجمع الإجابة
      timeline.push({
        type: 'html-keyboard-response',
        stimulus: `<p>هل تبدو المربعات منتظمة تمامًا؟<br>اضغط Y = نعم ، N = لا</p>`,
        choices: ['y', 'n'],
        data: { lineWidth: trial.lineWidth },
      });
    });

    // بدء التجربة
    jsPsych.run(timeline);
  </script>
</body>
</html>
